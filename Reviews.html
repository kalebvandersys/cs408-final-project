<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Other-Worldly Apartments: Reviews</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
<header>
    <h1>Other-Worldly Apartments</h1></header>
<div>
    <ul class="menu">
        <li class="menu-item"><a href="Homepage.html">HOME</a></li>
        <li class="menu-item"><a href="Comments.html">COMMENTS</a></li>
        <li class="menu-item"><a href="Reviews.html">REVIEWS</a></li>
        <li class="menu-item"><a href="Photos.html">PHOTOS</a></li>
    </ul>
</div>
<main>
    <h1>5-Star Reviews:
        <button id="load-data">Load 5 Star Reviews</button>
    </h1>
    <p id="lambda-info">
        <!-- loaded with AJAX -->
    </p>
    <script>
        // Function to load and display items in a table
        function loadTable() {
            let lambda = document.getElementById("lambda-info");
            let xhr = new XMLHttpRequest();

            xhr.onload = function () {
                try {
                    let items = JSON.parse(xhr.responseText);
                    let fiveStarItems = items.filter(item => item.price == 5);
                    let tableHTML = `
                <table border="1" cellpadding="8" cellspacing="0"
                       style="border-collapse: collapse; width: 80%; margin-top: 20px;">
                    <tr style="background-color: lightsalmon;">
                        <th>ID</th>
                        <th>Comment</th>
                        <th>Rating</th>
                        <th>Action</th>
                    </tr>
            `;

                    fiveStarItems.forEach(item => {
                        tableHTML += `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.price}</td>
                        <td>
                            <button onclick="deleteItem('${item.id}')"
                                    style="padding: 3px 8px; background-color: red; color: white; border: none; border-radius: 4px;">
                                Delete
                            </button>
                        </td>
                    </tr>
                `;
                    });

                    tableHTML += `</table>`;
                    lambda.innerHTML = tableHTML;

                } catch (err) {
                    lambda.innerHTML = `<p style="color: red;">Error loading data.</p>`;
                    console.error(err);
                }
            };

            xhr.open("GET", "https://93p45v1gi1.execute-api.us-east-2.amazonaws.com/items");
            xhr.send();
        }

        document.getElementById("load-data").onclick = loadTable;

        function deleteItem(itemId) {
            if (!confirm(`Are you sure you want to delete comment ${itemId}?`)) return;

            let xhr = new XMLHttpRequest();
            xhr.open("DELETE", `https://93p45v1gi1.execute-api.us-east-2.amazonaws.com/items/${itemId}`);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onload = function () {
                if (xhr.status >= 200 && xhr.status < 300) {
                    loadTable(); // Refresh table after deletion
                } else {
                    alert("Error deleting item: " + xhr.responseText);
                }
            };

            xhr.send();
        }
    </script>
</main>
</body>

</html>